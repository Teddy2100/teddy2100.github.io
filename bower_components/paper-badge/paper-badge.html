<link rel=import href=../polymer/polymer.html><link rel=import href=../iron-resizable-behavior/iron-resizable-behavior.html><link rel=import href=../iron-flex-layout/iron-flex-layout.html><link rel=import href=../paper-styles/default-theme.html><dom-module id=paper-badge><style>
    :host {
      display: block;
      position: absolute;
      outline: none;
    }

    #badge {
      @apply(--paper-font-common-base);
      font-weight: 600;
      font-size: 12px;
      border-radius: 50%;
      margin-left: var(--paper-badge-margin-left, 0px);
      margin-bottom: var(--paper-badge-margin-bottom, 0px);
      width: var(--paper-badge-width, 22px);
      height: var(--paper-badge-height, 22px);
      background-color: var(--paper-badge-background, --accent-color);
      opacity: var(--paper-badge-opacity, 1.0);
      color: var(--paper-badge-text-color, white);
      @apply(--layout);
      @apply(--layout-center-center);

      @apply(--paper-badge);
    }
  </style><template><div id=badge>{{label}}</div></template><script>
    Polymer({
      is: 'paper-badge',

      behaviors: [
        Polymer.IronResizableBehavior
      ],

      listeners: {
        'iron-resize': 'updatePosition'
      },

      properties: {
        /**
         * The id of the element that the badge is anchored to. This element
         * must be a sibling of the badge.
         */
        for: {
          type: String,
          observer: '_forChanged'
        },

        /**
         * The label displayed in the badge. The label is centered, and ideally
         * should have very few characters.
         */
        label: {
          type: String
        }
      },

      attached: function() {
        this._updateTarget();
      },

      _forChanged: function() {
        // The first time the property is set is before the badge is attached,
        // which means we're not ready to position it yet.
        if (!this.isAttached) {
          return;
        }
        this._updateTarget();
      },

      _updateTarget: function() {
        this._target = this.target;
        this.async(this.notifyResize, 1);
      },

      /**
       * Returns the target element that this badge is anchored to. It is
       * either the element given by the `for` attribute, or the immediate parent
       * of the badge.
       */
      get target () {
        var parentNode = Polymer.dom(this).parentNode;
        // If the parentNode is a document fragment, then we need to use the host.
        var ownerRoot = Polymer.dom(this).getOwnerRoot();
        var target;

        if (this.for) {
          target = Polymer.dom(ownerRoot).querySelector('#' + this.for);
        } else {
          target = parentNode.nodeType == Node.DOCUMENT_FRAGMENT_NODE ?
              ownerRoot.host : parentNode;
        }

        return target;
      },

      /**
       * Repositions the badge relative to its anchor element. This is called
       * automatically when the badge is attached or an `iron-resize` event is
       * fired (for exmaple if the window has resized, or your target is a
       * custom element that implements IronResizableBehavior).
       *
       * You should call this in all other cases when the achor's position
       * might have changed (for example, if it's visibility has changed, or
       * you've manually done a page re-layout).
       */
      updatePosition: function() {
        if (!this._target)
          return;

        if (!this.offsetParent)
          return;

        var parentRect = this.offsetParent.getBoundingClientRect();
        var targetRect = this._target.getBoundingClientRect();
        var thisRect = this.getBoundingClientRect();

        this.style.left = targetRect.left - parentRect.left +
            (targetRect.width - thisRect.width / 2) + 'px';
        this.style.top = targetRect.top - parentRect.top -
            (thisRect.height / 2) + 'px';
      }
    })
  </script></dom-module>