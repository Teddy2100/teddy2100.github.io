<canvas id="raw" width="192px" height="192px"></canvas>

<script>
var canvas=document.querySelector("#raw");
var context=canvas.getContext('2d'),iconxy=[144,144];
var mask=new Image();mask.src="./designs/mask_blawb.png",color="#69BD7A";
var img=new Image();img.src="./stored/raw/1e56d2bd14fad5aeb1b01416a2d964ff.png";
img.addEventListener("load",function(){mainxy=[(mask.width-iconxy[0])/2,(mask.height-iconxy[1])/2];
 for(var x=1;x<mask.width;x++){context.drawImage(img,mainxy[0]+x,mainxy[1]+x,iconxy[0],iconxy[1]);}

 context.putImageData(shadow(context.getImageData(0,0,mask.width,mask.height)),0,0);

 context.globalCompositeOperation="destination-over";
 var grd=context.createLinearGradient(0,0,50,mask.width);
  grd.addColorStop(0,lighten(color));
  grd.addColorStop(1,darken(color));
 context.fillStyle=grd;
 context.fillRect(0,0,mask.width,mask.width);

 context.globalCompositeOperation="source-over";
 context.drawImage(img,mainxy[0],mainxy[1],iconxy[0],iconxy[1]);

 //context.globalCompositeOperation="xor";
 //context.drawImage(mask,0,0);
 //console.log("DONE");
});

function shadow(imageData){
 for(var i=0;i<imageData.data.length;i+=4){if(imageData.data[i+3]!=0){
  imageData.data[i+0]=0;imageData.data[i+1]=0;imageData.data[i+2]=0;
  imageData.data[i+3]=Math.min(imageData.data[i+3],50);
 }}return imageData;
}

function HEX2RGB(hex){
 var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
 return result?{red:parseInt(result[1],16),green:parseInt(result[2],16),blue:parseInt(result[3],16)}:null;
}

function RGB2HEX(rgb){
 var hexdig='0123456789ABCDEF';
 var hex=function(d){return hexdig.charAt((d-(d%16))/16)+hexdig.charAt(d%16);};
 return "#"+hex(rgb.red)+hex(rgb.green)+hex(rgb.blue);
}

function lighten(rgb){
 var hex=(typeof rgb=="string");
 if(hex==true){rgb=HEX2RGB(rgb);}
  rgb.red=Math.min(255,rgb.red+25);
  rgb.green=Math.min(255,rgb.green+25);
  rgb.blue=Math.min(255,rgb.blue+25);
 if(hex==true){rgb=RGB2HEX(rgb);}
 console.log("Lighten",rgb);
 return rgb;
}

function darken(rgb){
 var hex=(typeof rgb=="string");
 if(hex==true){rgb=HEX2RGB(rgb);}
  rgb.red=Math.max(0,rgb.red-50);
  rgb.green=Math.max(0,rgb.green-50);
  rgb.rblue=Math.max(0,rgb.blue-50);
 if(hex==true){rgb=RGB2HEX(rgb);}
 console.log("Darken",rgb);
 return rgb;
}
</script>